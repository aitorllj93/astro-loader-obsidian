---
import { render } from "astro:content";

import type { Author as TAuthor, Document, Tag, SpaceshipConfig } from "../../types";

import CoverImage from "./CoverImage.astro";
import Tags from "./Tags.astro";
import ArticleDate from "./Date.astro";
import Author from "./Author.astro";
import Title from "./Title.astro";
import Subtitle from "./Subtitle.astro";
import Description from "./Description.astro";
import { isLegacyConfig } from "../../shell/utils/config";

export type Props = {
  config: SpaceshipConfig,
  author?: TAuthor | undefined;
  document: Document;
  tags: Tag[];
};

const { author, config, document, tags } = Astro.props;
const { data } = document;

// biome-ignore lint/suspicious/noExplicitAny: <explanation>
const { Content } = await render(document as any);

const showAuthor = isLegacyConfig(config) ? config.displayOptions?.showAuthor !== false : config.features.article.author.enabled;
const showPublishDate = isLegacyConfig(config) ? config.displayOptions?.showPublishDate !== false : config.features.article.publishDate.enabled;
const showTags = tags.length > 0;

const showMetaSection = showAuthor || showPublishDate || showTags;

const showDescriptionSection = !!data.description || showMetaSection;
---

<article class="article" data-pagefind-body>
  <section class:list={["article-content", ...(data.cssClass ?? []), ...(data.cssclasses ?? [])]}>
    <Title document={document} />
    <Subtitle document={document} />
    {
      showDescriptionSection && (
        <div class="article-description-section">
          <Description document={document} />
          {showMetaSection && (
            <div class="article-meta">
              <Author config={config} author={author} />
              <ArticleDate config={config} document={document} />
              <Tags tags={tags} />
            </div>
          )}
        </div>
      )
    }
    <CoverImage {...data} />
    <div data-pagefind-weight="0.1" class="article-body">
      <Content />
    </div>
  </section>
</article>
