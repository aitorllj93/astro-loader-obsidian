---
import type { Document, SpaceshipConfig } from "../../types";
import { isLegacyConfig } from "../../shell/utils/config";

import Sidebar from "../Sidebar/Sidebar.astro";

import Column from "./Column.astro";
import Tabset from "./Tabset.astro";

export type Props = {
  config: SpaceshipConfig;
  document?: Document;
  backlinks?: Document[] | undefined;
  showToC?: boolean;
  showLinks?: boolean;
  showGraph?: boolean;
  showMap?: boolean;
};

const config = Astro.props.config;

const mode = isLegacyConfig(config) ? (config.displayOptions?.rightSidebar?.mode as 'column' ?? 'tabset') : config.features.rightSidebar.mode;

const mapIsEnabled = Astro.props.showMap && (isLegacyConfig(config) ? true : config.features.rightSidebar.map.enabled);
const graphIsEnabled = Astro.props.showGraph && (isLegacyConfig(config) ? true : config.features.rightSidebar.graph.enabled);
const tocIsEnabled = Astro.props.showToC && (isLegacyConfig(config) ? true : config.features.rightSidebar.toc.enabled);
const linksIsEnabled = Astro.props.showLinks && (isLegacyConfig(config) ? true : config.features.rightSidebar.links.enabled);

const showSidebar = mapIsEnabled || graphIsEnabled || tocIsEnabled || linksIsEnabled;
---

{showSidebar && <Sidebar class="sidebar-desktop" open position="right" id="right-sidebar-desktop">
  { mode === 'column' && <Column id="right-sidebar-desktop-column" {...Astro.props} />}
  { mode === 'tabset' && <Tabset id="right-sidebar-desktop-tabset" {...Astro.props} />}
</Sidebar>}

{showSidebar && <Sidebar class="sidebar-touch" position="right" id="right-sidebar-touch">
  { mode === 'column' && <Column id="right-sidebar-touch-column" {...Astro.props} />}
  { mode === 'tabset' && <Tabset  id="right-sidebar-touch-tabset" {...Astro.props} />}
</Sidebar>}
